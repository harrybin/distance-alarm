<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml"
             xmlns:viewmodels="clr-namespace:DistanceAlarm.ViewModels"
             x:Class="DistanceAlarm.Views.SettingsPage"
             x:DataType="viewmodels:SettingsViewModel"
             Title="Settings">

    <ScrollView>
        <VerticalStackLayout Spacing="16" Padding="16">

            <!-- Connection Settings Card -->
            <Border Style="{StaticResource MaterialCard}">
                <VerticalStackLayout Spacing="16">
                    <Label Text="Connection Settings" 
                           Style="{StaticResource TitleMedium}" />
                    
                    <Grid ColumnDefinitions="*,Auto,Auto" ColumnSpacing="12">
                        <Label Grid.Column="0"
                               Text="Ping Interval (seconds)" 
                               VerticalOptions="Center" 
                               Style="{StaticResource BodyMedium}" />
                        <Stepper Grid.Column="1"
                                 Value="{Binding Settings.PingInterval}" 
                                 Minimum="1" 
                                 Maximum="60" 
                                 Increment="1" />
                        <Label Grid.Column="2"
                               Text="{Binding Settings.PingInterval}" 
                               VerticalOptions="Center" 
                               Style="{StaticResource LabelLarge}"
                               MinimumWidthRequest="30" />
                    </Grid>
                </VerticalStackLayout>
            </Border>

            <!-- Alarm Settings Card -->
            <Border Style="{StaticResource MaterialCard}">
                <VerticalStackLayout Spacing="20">
                    <Label Text="Alarm Settings" 
                           Style="{StaticResource TitleMedium}" />
                    
                    <!-- Vibration Settings -->
                    <VerticalStackLayout Spacing="12">
                        <HorizontalStackLayout Spacing="12">
                            <Switch IsToggled="{Binding Settings.VibrationEnabled}" />
                            <Label Text="Enable Vibration" 
                                   VerticalOptions="Center" 
                                   Style="{StaticResource BodyMedium}" />
                        </HorizontalStackLayout>
                        
                        <Grid ColumnDefinitions="*,Auto,Auto" 
                              ColumnSpacing="12" 
                              IsEnabled="{Binding Settings.VibrationEnabled}"
                              Opacity="{Binding Settings.VibrationEnabled, Converter={StaticResource BoolToOpacityConverter}}">
                            <Label Grid.Column="0"
                                   Text="Duration (ms)" 
                                   VerticalOptions="Center" 
                                   Style="{StaticResource BodyMedium}" />
                            <Stepper Grid.Column="1"
                                     Value="{Binding Settings.VibrationDuration}" 
                                     Minimum="100" 
                                     Maximum="5000" 
                                     Increment="100" />
                            <Label Grid.Column="2"
                                   Text="{Binding Settings.VibrationDuration}" 
                                   VerticalOptions="Center" 
                                   Style="{StaticResource LabelLarge}"
                                   MinimumWidthRequest="50" />
                        </Grid>
                    </VerticalStackLayout>

                    <!-- Sound Settings -->
                    <VerticalStackLayout Spacing="12">
                        <HorizontalStackLayout Spacing="12">
                            <Switch IsToggled="{Binding Settings.SoundEnabled}" />
                            <Label Text="Enable Sound" 
                                   VerticalOptions="Center" 
                                   Style="{StaticResource BodyMedium}" />
                        </HorizontalStackLayout>
                        
                        <Grid ColumnDefinitions="Auto,*,Auto" 
                              ColumnSpacing="12" 
                              IsEnabled="{Binding Settings.SoundEnabled}"
                              Opacity="{Binding Settings.SoundEnabled, Converter={StaticResource BoolToOpacityConverter}}">
                            <Label Grid.Column="0"
                                   Text="Volume" 
                                   VerticalOptions="Center" 
                                   Style="{StaticResource BodyMedium}" />
                            <Slider Grid.Column="1"
                                    Value="{Binding Settings.SoundVolume}" 
                                    Minimum="0" 
                                    Maximum="1" 
                                    MinimumWidthRequest="150" />
                            <Label Grid.Column="2"
                                   Text="{Binding Settings.SoundVolume, StringFormat='{0:P0}'}" 
                                   VerticalOptions="Center" 
                                   Style="{StaticResource LabelLarge}"
                                   MinimumWidthRequest="40" />
                        </Grid>
                    </VerticalStackLayout>

                    <!-- Notification Settings -->
                    <HorizontalStackLayout Spacing="12">
                        <Switch IsToggled="{Binding Settings.NotificationEnabled}" />
                        <Label Text="Enable Notifications" 
                               VerticalOptions="Center" 
                               Style="{StaticResource BodyMedium}" />
                    </HorizontalStackLayout>
                </VerticalStackLayout>
            </Border>

            <!-- Action Buttons Card -->
            <Border Style="{StaticResource MaterialCard}">
                <VerticalStackLayout Spacing="12">
                    <Label Text="Actions" 
                           Style="{StaticResource TitleMedium}" />
                    
                    <Grid ColumnDefinitions="*,*" ColumnSpacing="12">
                        <Button Grid.Column="0"
                                Text="Save Settings" 
                                Command="{Binding SaveSettingsCommand}" />
                        
                        <Button Grid.Column="1"
                                Text="Reset to Defaults" 
                                Command="{Binding ResetToDefaultsCommand}"
                                Style="{StaticResource OutlinedButton}" />
                    </Grid>
                </VerticalStackLayout>
            </Border>

        </VerticalStackLayout>
    </ScrollView>

</ContentPage>